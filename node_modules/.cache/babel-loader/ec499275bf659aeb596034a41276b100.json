{"ast":null,"code":"import FormatException from '../../../../FormatException';\nimport IllegalStateException from '../../../../IllegalStateException';\nimport StringBuilder from '../../../../util/StringBuilder';\nimport BlockParsedResult from './BlockParsedResult';\nimport DecodedChar from './DecodedChar';\nimport DecodedInformation from './DecodedInformation';\nimport DecodedNumeric from './DecodedNumeric';\nimport FieldParser from './FieldParser';\n\nvar GeneralAppIdDecoder = function () {\n  function GeneralAppIdDecoder(information) {\n    this.buffer = new StringBuilder();\n    this.information = information;\n  }\n\n  GeneralAppIdDecoder.prototype.decodeAllCodes = function (buff, initialPosition) {\n    var currentPosition = initialPosition;\n    var remaining = null;\n\n    do {\n      var info = this.decodeGeneralPurposeField(currentPosition, remaining);\n      var parsedFields = FieldParser.parseFieldsInGeneralPurpose(info.getNewString());\n\n      if (parsedFields != null) {\n        buff.append(parsedFields);\n      }\n\n      if (info.isRemaining()) {\n        remaining = '' + info.getRemainingValue();\n      } else {\n        remaining = null;\n      }\n\n      if (currentPosition === info.getNewPosition()) {\n        // No step forward!\n        break;\n      }\n\n      currentPosition = info.getNewPosition();\n    } while (true);\n\n    return buff.toString();\n  };\n\n  GeneralAppIdDecoder.prototype.isStillNumeric = function (pos) {\n    // It's numeric if it still has 7 positions\n    // and one of the first 4 bits is \"1\".\n    if (pos + 7 > this.information.getSize()) {\n      return pos + 4 <= this.information.getSize();\n    }\n\n    for (var i = pos; i < pos + 3; ++i) {\n      if (this.information.get(i)) {\n        return true;\n      }\n    }\n\n    return this.information.get(pos + 3);\n  };\n\n  GeneralAppIdDecoder.prototype.decodeNumeric = function (pos) {\n    if (pos + 7 > this.information.getSize()) {\n      var numeric_1 = this.extractNumericValueFromBitArray(pos, 4);\n\n      if (numeric_1 === 0) {\n        return new DecodedNumeric(this.information.getSize(), DecodedNumeric.FNC1, DecodedNumeric.FNC1);\n      }\n\n      return new DecodedNumeric(this.information.getSize(), numeric_1 - 1, DecodedNumeric.FNC1);\n    }\n\n    var numeric = this.extractNumericValueFromBitArray(pos, 7);\n    var digit1 = (numeric - 8) / 11;\n    var digit2 = (numeric - 8) % 11;\n    return new DecodedNumeric(pos + 7, digit1, digit2);\n  };\n\n  GeneralAppIdDecoder.prototype.extractNumericValueFromBitArray = function (pos, bits) {\n    return GeneralAppIdDecoder.extractNumericValueFromBitArray(this.information, pos, bits);\n  };\n\n  GeneralAppIdDecoder.extractNumericValueFromBitArray = function (information, pos, bits) {\n    var value = 0;\n\n    for (var i = 0; i < bits; ++i) {\n      if (information.get(pos + i)) {\n        value |= 1 << bits - i - 1;\n      }\n    }\n\n    return value;\n  };\n\n  GeneralAppIdDecoder.prototype.decodeGeneralPurposeField = function (pos, remaining) {\n    // this.buffer.setLength(0);\n    this.buffer.setLengthToZero();\n\n    if (remaining != null) {\n      this.buffer.append(remaining);\n    }\n\n    this.current.setPosition(pos);\n    var lastDecoded = this.parseBlocks();\n\n    if (lastDecoded != null && lastDecoded.isRemaining()) {\n      return new DecodedInformation(this.current.getPosition(), this.buffer.toString(), lastDecoded.getRemainingValue());\n    }\n\n    return new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n  };\n\n  GeneralAppIdDecoder.prototype.parseBlocks = function () {\n    var isFinished;\n    var result;\n\n    do {\n      var initialPosition = this.current.getPosition();\n\n      if (this.current.isAlpha()) {\n        result = this.parseAlphaBlock();\n        isFinished = result.isFinished();\n      } else if (this.current.isIsoIec646()) {\n        result = this.parseIsoIec646Block();\n        isFinished = result.isFinished();\n      } else {\n        // it must be numeric\n        result = this.parseNumericBlock();\n        isFinished = result.isFinished();\n      }\n\n      var positionChanged = initialPosition !== this.current.getPosition();\n\n      if (!positionChanged && !isFinished) {\n        break;\n      }\n    } while (!isFinished);\n\n    return result.getDecodedInformation();\n  };\n\n  GeneralAppIdDecoder.prototype.parseNumericBlock = function () {\n    while (this.isStillNumeric(this.current.getPosition())) {\n      var numeric = this.decodeNumeric(this.current.getPosition());\n      this.current.setPosition(numeric.getNewPosition());\n\n      if (numeric.isFirstDigitFNC1()) {\n        var information = void 0;\n\n        if (numeric.isSecondDigitFNC1()) {\n          information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n        } else {\n          information = new DecodedInformation(this.current.getPosition(), this.buffer.toString(), numeric.getSecondDigit());\n        }\n\n        return new BlockParsedResult(true, information);\n      }\n\n      this.buffer.append(numeric.getFirstDigit());\n\n      if (numeric.isSecondDigitFNC1()) {\n        var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n        return new BlockParsedResult(true, information);\n      }\n\n      this.buffer.append(numeric.getSecondDigit());\n    }\n\n    if (this.isNumericToAlphaNumericLatch(this.current.getPosition())) {\n      this.current.setAlpha();\n      this.current.incrementPosition(4);\n    }\n\n    return new BlockParsedResult(false);\n  };\n\n  GeneralAppIdDecoder.prototype.parseIsoIec646Block = function () {\n    while (this.isStillIsoIec646(this.current.getPosition())) {\n      var iso = this.decodeIsoIec646(this.current.getPosition());\n      this.current.setPosition(iso.getNewPosition());\n\n      if (iso.isFNC1()) {\n        var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n        return new BlockParsedResult(true, information);\n      }\n\n      this.buffer.append(iso.getValue());\n    }\n\n    if (this.isAlphaOr646ToNumericLatch(this.current.getPosition())) {\n      this.current.incrementPosition(3);\n      this.current.setNumeric();\n    } else if (this.isAlphaTo646ToAlphaLatch(this.current.getPosition())) {\n      if (this.current.getPosition() + 5 < this.information.getSize()) {\n        this.current.incrementPosition(5);\n      } else {\n        this.current.setPosition(this.information.getSize());\n      }\n\n      this.current.setAlpha();\n    }\n\n    return new BlockParsedResult(false);\n  };\n\n  GeneralAppIdDecoder.prototype.parseAlphaBlock = function () {\n    while (this.isStillAlpha(this.current.getPosition())) {\n      var alpha = this.decodeAlphanumeric(this.current.getPosition());\n      this.current.setPosition(alpha.getNewPosition());\n\n      if (alpha.isFNC1()) {\n        var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n        return new BlockParsedResult(true, information); // end of the char block\n      }\n\n      this.buffer.append(alpha.getValue());\n    }\n\n    if (this.isAlphaOr646ToNumericLatch(this.current.getPosition())) {\n      this.current.incrementPosition(3);\n      this.current.setNumeric();\n    } else if (this.isAlphaTo646ToAlphaLatch(this.current.getPosition())) {\n      if (this.current.getPosition() + 5 < this.information.getSize()) {\n        this.current.incrementPosition(5);\n      } else {\n        this.current.setPosition(this.information.getSize());\n      }\n\n      this.current.setIsoIec646();\n    }\n\n    return new BlockParsedResult(false);\n  };\n\n  GeneralAppIdDecoder.prototype.isStillIsoIec646 = function (pos) {\n    if (pos + 5 > this.information.getSize()) {\n      return false;\n    }\n\n    var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n\n    if (fiveBitValue >= 5 && fiveBitValue < 16) {\n      return true;\n    }\n\n    if (pos + 7 > this.information.getSize()) {\n      return false;\n    }\n\n    var sevenBitValue = this.extractNumericValueFromBitArray(pos, 7);\n\n    if (sevenBitValue >= 64 && sevenBitValue < 116) {\n      return true;\n    }\n\n    if (pos + 8 > this.information.getSize()) {\n      return false;\n    }\n\n    var eightBitValue = this.extractNumericValueFromBitArray(pos, 8);\n    return eightBitValue >= 232 && eightBitValue < 253;\n  };\n\n  GeneralAppIdDecoder.prototype.decodeIsoIec646 = function (pos) {\n    var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n\n    if (fiveBitValue === 15) {\n      return new DecodedChar(pos + 5, DecodedChar.FNC1);\n    }\n\n    if (fiveBitValue >= 5 && fiveBitValue < 15) {\n      return new DecodedChar(pos + 5, '0' + (fiveBitValue - 5));\n    }\n\n    var sevenBitValue = this.extractNumericValueFromBitArray(pos, 7);\n\n    if (sevenBitValue >= 64 && sevenBitValue < 90) {\n      return new DecodedChar(pos + 7, '' + (sevenBitValue + 1));\n    }\n\n    if (sevenBitValue >= 90 && sevenBitValue < 116) {\n      return new DecodedChar(pos + 7, '' + (sevenBitValue + 7));\n    }\n\n    var eightBitValue = this.extractNumericValueFromBitArray(pos, 8);\n    var c;\n\n    switch (eightBitValue) {\n      case 232:\n        c = '!';\n        break;\n\n      case 233:\n        c = '\"';\n        break;\n\n      case 234:\n        c = '%';\n        break;\n\n      case 235:\n        c = '&';\n        break;\n\n      case 236:\n        c = '\\'';\n        break;\n\n      case 237:\n        c = '(';\n        break;\n\n      case 238:\n        c = ')';\n        break;\n\n      case 239:\n        c = '*';\n        break;\n\n      case 240:\n        c = '+';\n        break;\n\n      case 241:\n        c = ',';\n        break;\n\n      case 242:\n        c = '-';\n        break;\n\n      case 243:\n        c = '.';\n        break;\n\n      case 244:\n        c = '/';\n        break;\n\n      case 245:\n        c = ':';\n        break;\n\n      case 246:\n        c = ';';\n        break;\n\n      case 247:\n        c = '<';\n        break;\n\n      case 248:\n        c = '=';\n        break;\n\n      case 249:\n        c = '>';\n        break;\n\n      case 250:\n        c = '?';\n        break;\n\n      case 251:\n        c = '_';\n        break;\n\n      case 252:\n        c = ' ';\n        break;\n\n      default:\n        throw new FormatException();\n    }\n\n    return new DecodedChar(pos + 8, c);\n  };\n\n  GeneralAppIdDecoder.prototype.isStillAlpha = function (pos) {\n    if (pos + 5 > this.information.getSize()) {\n      return false;\n    } // We now check if it's a valid 5-bit value (0..9 and FNC1)\n\n\n    var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n\n    if (fiveBitValue >= 5 && fiveBitValue < 16) {\n      return true;\n    }\n\n    if (pos + 6 > this.information.getSize()) {\n      return false;\n    }\n\n    var sixBitValue = this.extractNumericValueFromBitArray(pos, 6);\n    return sixBitValue >= 16 && sixBitValue < 63; // 63 not included\n  };\n\n  GeneralAppIdDecoder.prototype.decodeAlphanumeric = function (pos) {\n    var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n\n    if (fiveBitValue === 15) {\n      return new DecodedChar(pos + 5, DecodedChar.FNC1);\n    }\n\n    if (fiveBitValue >= 5 && fiveBitValue < 15) {\n      return new DecodedChar(pos + 5, '0' + (fiveBitValue - 5));\n    }\n\n    var sixBitValue = this.extractNumericValueFromBitArray(pos, 6);\n\n    if (sixBitValue >= 32 && sixBitValue < 58) {\n      return new DecodedChar(pos + 6, '' + (sixBitValue + 33));\n    }\n\n    var c;\n\n    switch (sixBitValue) {\n      case 58:\n        c = '*';\n        break;\n\n      case 59:\n        c = ',';\n        break;\n\n      case 60:\n        c = '-';\n        break;\n\n      case 61:\n        c = '.';\n        break;\n\n      case 62:\n        c = '/';\n        break;\n\n      default:\n        throw new IllegalStateException('Decoding invalid alphanumeric value: ' + sixBitValue);\n    }\n\n    return new DecodedChar(pos + 6, c);\n  };\n\n  GeneralAppIdDecoder.prototype.isAlphaTo646ToAlphaLatch = function (pos) {\n    if (pos + 1 > this.information.getSize()) {\n      return false;\n    }\n\n    for (var i = 0; i < 5 && i + pos < this.information.getSize(); ++i) {\n      if (i === 2) {\n        if (!this.information.get(pos + 2)) {\n          return false;\n        }\n      } else if (this.information.get(pos + i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  GeneralAppIdDecoder.prototype.isAlphaOr646ToNumericLatch = function (pos) {\n    // Next is alphanumeric if there are 3 positions and they are all zeros\n    if (pos + 3 > this.information.getSize()) {\n      return false;\n    }\n\n    for (var i = pos; i < pos + 3; ++i) {\n      if (this.information.get(i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  GeneralAppIdDecoder.prototype.isNumericToAlphaNumericLatch = function (pos) {\n    // Next is alphanumeric if there are 4 positions and they are all zeros, or\n    // if there is a subset of this just before the end of the symbol\n    if (pos + 1 > this.information.getSize()) {\n      return false;\n    }\n\n    for (var i = 0; i < 4 && i + pos < this.information.getSize(); ++i) {\n      if (this.information.get(pos + i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  return GeneralAppIdDecoder;\n}();\n\nexport default GeneralAppIdDecoder;","map":{"version":3,"sources":["../../../../../../../src/core/oned/rss/expanded/decoders/GeneralAppIdDecoder.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import FormatException from '../../../../FormatException';\nimport IllegalStateException from '../../../../IllegalStateException';\nimport StringBuilder from '../../../../util/StringBuilder';\nimport BlockParsedResult from './BlockParsedResult';\nimport DecodedChar from './DecodedChar';\nimport DecodedInformation from './DecodedInformation';\nimport DecodedNumeric from './DecodedNumeric';\nimport FieldParser from './FieldParser';\nvar GeneralAppIdDecoder = /** @class */ (function () {\n    function GeneralAppIdDecoder(information) {\n        this.buffer = new StringBuilder();\n        this.information = information;\n    }\n    GeneralAppIdDecoder.prototype.decodeAllCodes = function (buff, initialPosition) {\n        var currentPosition = initialPosition;\n        var remaining = null;\n        do {\n            var info = this.decodeGeneralPurposeField(currentPosition, remaining);\n            var parsedFields = FieldParser.parseFieldsInGeneralPurpose(info.getNewString());\n            if (parsedFields != null) {\n                buff.append(parsedFields);\n            }\n            if (info.isRemaining()) {\n                remaining = '' + info.getRemainingValue();\n            }\n            else {\n                remaining = null;\n            }\n            if (currentPosition === info.getNewPosition()) { // No step forward!\n                break;\n            }\n            currentPosition = info.getNewPosition();\n        } while (true);\n        return buff.toString();\n    };\n    GeneralAppIdDecoder.prototype.isStillNumeric = function (pos) {\n        // It's numeric if it still has 7 positions\n        // and one of the first 4 bits is \"1\".\n        if (pos + 7 > this.information.getSize()) {\n            return pos + 4 <= this.information.getSize();\n        }\n        for (var i = pos; i < pos + 3; ++i) {\n            if (this.information.get(i)) {\n                return true;\n            }\n        }\n        return this.information.get(pos + 3);\n    };\n    GeneralAppIdDecoder.prototype.decodeNumeric = function (pos) {\n        if (pos + 7 > this.information.getSize()) {\n            var numeric_1 = this.extractNumericValueFromBitArray(pos, 4);\n            if (numeric_1 === 0) {\n                return new DecodedNumeric(this.information.getSize(), DecodedNumeric.FNC1, DecodedNumeric.FNC1);\n            }\n            return new DecodedNumeric(this.information.getSize(), numeric_1 - 1, DecodedNumeric.FNC1);\n        }\n        var numeric = this.extractNumericValueFromBitArray(pos, 7);\n        var digit1 = (numeric - 8) / 11;\n        var digit2 = (numeric - 8) % 11;\n        return new DecodedNumeric(pos + 7, digit1, digit2);\n    };\n    GeneralAppIdDecoder.prototype.extractNumericValueFromBitArray = function (pos, bits) {\n        return GeneralAppIdDecoder.extractNumericValueFromBitArray(this.information, pos, bits);\n    };\n    GeneralAppIdDecoder.extractNumericValueFromBitArray = function (information, pos, bits) {\n        var value = 0;\n        for (var i = 0; i < bits; ++i) {\n            if (information.get(pos + i)) {\n                value |= 1 << (bits - i - 1);\n            }\n        }\n        return value;\n    };\n    GeneralAppIdDecoder.prototype.decodeGeneralPurposeField = function (pos, remaining) {\n        // this.buffer.setLength(0);\n        this.buffer.setLengthToZero();\n        if (remaining != null) {\n            this.buffer.append(remaining);\n        }\n        this.current.setPosition(pos);\n        var lastDecoded = this.parseBlocks();\n        if (lastDecoded != null && lastDecoded.isRemaining()) {\n            return new DecodedInformation(this.current.getPosition(), this.buffer.toString(), lastDecoded.getRemainingValue());\n        }\n        return new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n    };\n    GeneralAppIdDecoder.prototype.parseBlocks = function () {\n        var isFinished;\n        var result;\n        do {\n            var initialPosition = this.current.getPosition();\n            if (this.current.isAlpha()) {\n                result = this.parseAlphaBlock();\n                isFinished = result.isFinished();\n            }\n            else if (this.current.isIsoIec646()) {\n                result = this.parseIsoIec646Block();\n                isFinished = result.isFinished();\n            }\n            else { // it must be numeric\n                result = this.parseNumericBlock();\n                isFinished = result.isFinished();\n            }\n            var positionChanged = initialPosition !== this.current.getPosition();\n            if (!positionChanged && !isFinished) {\n                break;\n            }\n        } while (!isFinished);\n        return result.getDecodedInformation();\n    };\n    GeneralAppIdDecoder.prototype.parseNumericBlock = function () {\n        while (this.isStillNumeric(this.current.getPosition())) {\n            var numeric = this.decodeNumeric(this.current.getPosition());\n            this.current.setPosition(numeric.getNewPosition());\n            if (numeric.isFirstDigitFNC1()) {\n                var information = void 0;\n                if (numeric.isSecondDigitFNC1()) {\n                    information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n                }\n                else {\n                    information = new DecodedInformation(this.current.getPosition(), this.buffer.toString(), numeric.getSecondDigit());\n                }\n                return new BlockParsedResult(true, information);\n            }\n            this.buffer.append(numeric.getFirstDigit());\n            if (numeric.isSecondDigitFNC1()) {\n                var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n                return new BlockParsedResult(true, information);\n            }\n            this.buffer.append(numeric.getSecondDigit());\n        }\n        if (this.isNumericToAlphaNumericLatch(this.current.getPosition())) {\n            this.current.setAlpha();\n            this.current.incrementPosition(4);\n        }\n        return new BlockParsedResult(false);\n    };\n    GeneralAppIdDecoder.prototype.parseIsoIec646Block = function () {\n        while (this.isStillIsoIec646(this.current.getPosition())) {\n            var iso = this.decodeIsoIec646(this.current.getPosition());\n            this.current.setPosition(iso.getNewPosition());\n            if (iso.isFNC1()) {\n                var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n                return new BlockParsedResult(true, information);\n            }\n            this.buffer.append(iso.getValue());\n        }\n        if (this.isAlphaOr646ToNumericLatch(this.current.getPosition())) {\n            this.current.incrementPosition(3);\n            this.current.setNumeric();\n        }\n        else if (this.isAlphaTo646ToAlphaLatch(this.current.getPosition())) {\n            if (this.current.getPosition() + 5 < this.information.getSize()) {\n                this.current.incrementPosition(5);\n            }\n            else {\n                this.current.setPosition(this.information.getSize());\n            }\n            this.current.setAlpha();\n        }\n        return new BlockParsedResult(false);\n    };\n    GeneralAppIdDecoder.prototype.parseAlphaBlock = function () {\n        while (this.isStillAlpha(this.current.getPosition())) {\n            var alpha = this.decodeAlphanumeric(this.current.getPosition());\n            this.current.setPosition(alpha.getNewPosition());\n            if (alpha.isFNC1()) {\n                var information = new DecodedInformation(this.current.getPosition(), this.buffer.toString());\n                return new BlockParsedResult(true, information); // end of the char block\n            }\n            this.buffer.append(alpha.getValue());\n        }\n        if (this.isAlphaOr646ToNumericLatch(this.current.getPosition())) {\n            this.current.incrementPosition(3);\n            this.current.setNumeric();\n        }\n        else if (this.isAlphaTo646ToAlphaLatch(this.current.getPosition())) {\n            if (this.current.getPosition() + 5 < this.information.getSize()) {\n                this.current.incrementPosition(5);\n            }\n            else {\n                this.current.setPosition(this.information.getSize());\n            }\n            this.current.setIsoIec646();\n        }\n        return new BlockParsedResult(false);\n    };\n    GeneralAppIdDecoder.prototype.isStillIsoIec646 = function (pos) {\n        if (pos + 5 > this.information.getSize()) {\n            return false;\n        }\n        var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n        if (fiveBitValue >= 5 && fiveBitValue < 16) {\n            return true;\n        }\n        if (pos + 7 > this.information.getSize()) {\n            return false;\n        }\n        var sevenBitValue = this.extractNumericValueFromBitArray(pos, 7);\n        if (sevenBitValue >= 64 && sevenBitValue < 116) {\n            return true;\n        }\n        if (pos + 8 > this.information.getSize()) {\n            return false;\n        }\n        var eightBitValue = this.extractNumericValueFromBitArray(pos, 8);\n        return eightBitValue >= 232 && eightBitValue < 253;\n    };\n    GeneralAppIdDecoder.prototype.decodeIsoIec646 = function (pos) {\n        var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n        if (fiveBitValue === 15) {\n            return new DecodedChar(pos + 5, DecodedChar.FNC1);\n        }\n        if (fiveBitValue >= 5 && fiveBitValue < 15) {\n            return new DecodedChar(pos + 5, ('0' + (fiveBitValue - 5)));\n        }\n        var sevenBitValue = this.extractNumericValueFromBitArray(pos, 7);\n        if (sevenBitValue >= 64 && sevenBitValue < 90) {\n            return new DecodedChar(pos + 7, ('' + (sevenBitValue + 1)));\n        }\n        if (sevenBitValue >= 90 && sevenBitValue < 116) {\n            return new DecodedChar(pos + 7, ('' + (sevenBitValue + 7)));\n        }\n        var eightBitValue = this.extractNumericValueFromBitArray(pos, 8);\n        var c;\n        switch (eightBitValue) {\n            case 232:\n                c = '!';\n                break;\n            case 233:\n                c = '\"';\n                break;\n            case 234:\n                c = '%';\n                break;\n            case 235:\n                c = '&';\n                break;\n            case 236:\n                c = '\\'';\n                break;\n            case 237:\n                c = '(';\n                break;\n            case 238:\n                c = ')';\n                break;\n            case 239:\n                c = '*';\n                break;\n            case 240:\n                c = '+';\n                break;\n            case 241:\n                c = ',';\n                break;\n            case 242:\n                c = '-';\n                break;\n            case 243:\n                c = '.';\n                break;\n            case 244:\n                c = '/';\n                break;\n            case 245:\n                c = ':';\n                break;\n            case 246:\n                c = ';';\n                break;\n            case 247:\n                c = '<';\n                break;\n            case 248:\n                c = '=';\n                break;\n            case 249:\n                c = '>';\n                break;\n            case 250:\n                c = '?';\n                break;\n            case 251:\n                c = '_';\n                break;\n            case 252:\n                c = ' ';\n                break;\n            default:\n                throw new FormatException();\n        }\n        return new DecodedChar(pos + 8, c);\n    };\n    GeneralAppIdDecoder.prototype.isStillAlpha = function (pos) {\n        if (pos + 5 > this.information.getSize()) {\n            return false;\n        }\n        // We now check if it's a valid 5-bit value (0..9 and FNC1)\n        var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n        if (fiveBitValue >= 5 && fiveBitValue < 16) {\n            return true;\n        }\n        if (pos + 6 > this.information.getSize()) {\n            return false;\n        }\n        var sixBitValue = this.extractNumericValueFromBitArray(pos, 6);\n        return sixBitValue >= 16 && sixBitValue < 63; // 63 not included\n    };\n    GeneralAppIdDecoder.prototype.decodeAlphanumeric = function (pos) {\n        var fiveBitValue = this.extractNumericValueFromBitArray(pos, 5);\n        if (fiveBitValue === 15) {\n            return new DecodedChar(pos + 5, DecodedChar.FNC1);\n        }\n        if (fiveBitValue >= 5 && fiveBitValue < 15) {\n            return new DecodedChar(pos + 5, ('0' + (fiveBitValue - 5)));\n        }\n        var sixBitValue = this.extractNumericValueFromBitArray(pos, 6);\n        if (sixBitValue >= 32 && sixBitValue < 58) {\n            return new DecodedChar(pos + 6, ('' + (sixBitValue + 33)));\n        }\n        var c;\n        switch (sixBitValue) {\n            case 58:\n                c = '*';\n                break;\n            case 59:\n                c = ',';\n                break;\n            case 60:\n                c = '-';\n                break;\n            case 61:\n                c = '.';\n                break;\n            case 62:\n                c = '/';\n                break;\n            default:\n                throw new IllegalStateException('Decoding invalid alphanumeric value: ' + sixBitValue);\n        }\n        return new DecodedChar(pos + 6, c);\n    };\n    GeneralAppIdDecoder.prototype.isAlphaTo646ToAlphaLatch = function (pos) {\n        if (pos + 1 > this.information.getSize()) {\n            return false;\n        }\n        for (var i = 0; i < 5 && i + pos < this.information.getSize(); ++i) {\n            if (i === 2) {\n                if (!this.information.get(pos + 2)) {\n                    return false;\n                }\n            }\n            else if (this.information.get(pos + i)) {\n                return false;\n            }\n        }\n        return true;\n    };\n    GeneralAppIdDecoder.prototype.isAlphaOr646ToNumericLatch = function (pos) {\n        // Next is alphanumeric if there are 3 positions and they are all zeros\n        if (pos + 3 > this.information.getSize()) {\n            return false;\n        }\n        for (var i = pos; i < pos + 3; ++i) {\n            if (this.information.get(i)) {\n                return false;\n            }\n        }\n        return true;\n    };\n    GeneralAppIdDecoder.prototype.isNumericToAlphaNumericLatch = function (pos) {\n        // Next is alphanumeric if there are 4 positions and they are all zeros, or\n        // if there is a subset of this just before the end of the symbol\n        if (pos + 1 > this.information.getSize()) {\n            return false;\n        }\n        for (var i = 0; i < 4 && i + pos < this.information.getSize(); ++i) {\n            if (this.information.get(pos + i)) {\n                return false;\n            }\n        }\n        return true;\n    };\n    return GeneralAppIdDecoder;\n}());\nexport default GeneralAppIdDecoder;\n//# sourceMappingURL=GeneralAppIdDecoder.js.map"]},"metadata":{},"sourceType":"module"}